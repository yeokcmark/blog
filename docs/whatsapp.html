<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>maRk's blog</title>



  <meta name="article:author" content="Mark Y"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="maRk&#39;s blog"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="maRk&#39;s blog"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="maRk&#39;s blog"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","output","toc","toc_float"]}},"value":[{"type":"character","attributes":{},"value":["maRk's blog"]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Mark Y"]}]}]},{"type":"character","attributes":{},"value":["distill::distill_article"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      28px;
    --body-size:       1.16rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     rgba(0, 0, 0, 0.8);
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       22px;
    --text-color:       #fefef9; /*tufte off-white*/
    --text-size:        16px;
    --hover-color:      #0F2E3D; /*distill blue*/
    --bkgd-color:       #ad0a2b; /*some kinda red*/
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        12px;
    --hover-color:      #0F2E3D; /*some kinda red*/
    --bkgd-color:       #ad0a2b; /*distill blue*/
  }

  /*-- Additional custom styles --*/


  /* Add any additional CSS rules below                      */
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 10%;    
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }

  .posts-with-sidebar .posts-list {
    width: 67%;
    margin-left: 10%;
  }

  .posts-sidebar {
    font-size: 75%;
    margin-right: 10%;
  }

  d-title {
    visibility: hidden;
  }
  description {
    visibility: hidden;
  }

  body {
    background: #fefef9; /*tufte off-white*/
  }</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <link href="site_libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
  <script src="site_libs/bsTable-3.3.7/bootstrapTable.js"></script>
  <script src="site_libs/htmlwidgets-1.6.3/htmlwidgets.js"></script>
  <link href="site_libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
  <script src="site_libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
  <script src="site_libs/wordcloud2-0.0.1/hover.js"></script>
  <script src="site_libs/wordcloud2-binding-0.2.2/wordcloud2.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <style type="text/css">

  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      28px;
    --body-size:       1.16rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     rgba(0, 0, 0, 0.8);
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       22px;
    --text-color:       #fefef9; /*tufte off-white*/
    --text-size:        16px;
    --hover-color:      #0F2E3D; /*distill blue*/
    --bkgd-color:       #ad0a2b; /*some kinda red*/
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        12px;
    --hover-color:      #0F2E3D; /*some kinda red*/
    --bkgd-color:       #ad0a2b; /*distill blue*/
  }

  /*-- Additional custom styles --*/


  /* Add any additional CSS rules below                      */
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 10%;    
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }

  .posts-with-sidebar .posts-list {
    width: 67%;
    margin-left: 10%;
  }

  .posts-sidebar {
    font-size: 75%;
    margin-right: 10%;
  }

  d-title {
    visibility: hidden;
  }
  description {
    visibility: hidden;
  }

  body {
    background: #fefef9; /*tufte off-white*/
  }
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="theme.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"maRk's blog","authors":[{"author":"Mark Y","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">maRk's blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="nikkei225.html">Nikkei225</a>
<a href="whatsapp.html">Whatsapp Chat Analysis</a>
<a href="about.html">About</a>
<a href="https://github.com/yeokcmark">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>maRks blog</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  Mark Y  
  

</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#project" id="toc-project">Project</a></li>
<li><a href="#exporting-whatsapp-chat" id="toc-exporting-whatsapp-chat">Exporting Whatsapp Chat</a></li>
<li><a href="#import-and-data-wrangling" id="toc-import-and-data-wrangling">Import and Data Wrangling</a></li>
<li><a href="#data-visualization" id="toc-data-visualization">Data Visualization</a></li>
<li><a href="#tokenize-the-words" id="toc-tokenize-the-words">Tokenize the words</a></li>
<li><a href="#afinn-bing-and-nrc" id="toc-afinn-bing-and-nrc">AFINN, BING and NRC</a></li>
<li><a href="#lets-do-some-very-basic-eda" id="toc-lets-do-some-very-basic-eda">Lets do some very basic EDA</a></li>
<li><a href="#have-fun-with-word-cloud" id="toc-have-fun-with-word-cloud">Have fun with word cloud</a></li>
<li><a href="#sentiment-analysis-using-afinn-index" id="toc-sentiment-analysis-using-afinn-index">Sentiment Analysis using AFINN Index</a></li>
<li><a href="#cumulative-average-daily-sentiment" id="toc-cumulative-average-daily-sentiment">Cumulative Average Daily Sentiment</a></li>
<li><a href="#sentiment-analysis-marc-vs-andrew" id="toc-sentiment-analysis-marc-vs-andrew">Sentiment Analysis: Marc vs Andrew</a></li>
<li><a href="#tokenizing-by-n-grams" id="toc-tokenizing-by-n-grams">Tokenizing by n-grams</a></li>
<li><a href="#sentiment-analysis-using-bing" id="toc-sentiment-analysis-using-bing">Sentiment Analysis using Bing</a></li>
<li><a href="#net-sentiment-using-bing" id="toc-net-sentiment-using-bing">Net Sentiment Using Bing</a></li>
<li><a href="#sentiment-analysis-using-nrc" id="toc-sentiment-analysis-using-nrc">Sentiment Analysis using NRC</a></li>
<li><a href="#final-thoughts" id="toc-final-thoughts">Final Thoughts</a></li>
</ul>
</nav>
</div>
<h3 id="introduction">Introduction</h3>
<p>Im attending the Certified Data Analytics (R) Specialist course taught by Professor Sungjong Roh at SMU Academy. In Module 3: Web scraping and Data Insights, we learnt the basics of Natural Language Processing (NLP) and Sentiment Analysis of text.</p>
<p>I was particularly intrigued by the topic of Sentiment Analysis, and furthered my knowledge by reading the book Text Mining with R: A Tidy Approach by Julia Silge &amp; David Robinson.</p>
<p><img src="images/cover.png" style="width:30.0%" data-fig-align="center" /></p>
<p>You may access read the book by following this <a href="https://www.tidytextmining.com/">link</a>.</p>
<h3 id="project">Project</h3>
<p>To further hone my skills in R, basic natural language processing (NLP) and sentiment analysis, I thought that it would be cool to do a sentiment analysis of my familys Whatsapp group chat. This group chat was started in June 2019 and comprises 4 members, my wife (Angelina) , my two sons Marc (age 18) and Andrew (age 13) and me.</p>
<p>The chatgroup contains approximately 65,000 messages, and is used mainly to coordinate schedules, update whereabouts of each member, and chatting about anything under the sun. My end goal is to see if the tools I learnt in class could be used to provide an insight into the:</p>
<ul>
<li><p>overall sentiment of our chatgroup. Do we generally use positive language (I hope so) or is the group environment toxic (that would be a disappointment!).</p></li>
<li><p>individual sentiment of each member of the chatgroup. Are there members who are positive/negative and does that gel with my knowledge of their personality? Were there periods of positive or negative sentiment throughout the year(s), and does that tie-in with any significant events the family was experiencing?</p></li>
</ul>
<h3 id="exporting-whatsapp-chat">Exporting Whatsapp Chat</h3>
<p>This is fairly easy to do, and the chat exports as a single text file with date/timestamp. Unfortunately, stickers and emojis which are often used in our chatgroup cannot be exported.</p>
<h3 id="import-and-data-wrangling">Import and Data Wrangling</h3>
<p>The chat file can be imported into R using read_csv(). The chat.txt file imported from Whatsapp was relatively clean, and required minimal wrangling.</p>
<p>The date of message sent, name of sender, and text message were extracted using a combination of str_extract() and regex patterns. Date was subsequently formatted using dmy(). NA data was filtered using na.omit(). Finally, a message_id was assigned to each row using the function rowid_to_column()</p>
<h3 id="data-visualization">Data Visualization</h3>
<p>Lets find out who sent the most messages within the chatgroup.</p>
<center>
<em>Mirror mirror on the wall, whos the most chatty of them all?</em>
</center>
<p>Anyone wants to make a guess?</p>
<p>Surprise surpise! My wife sent the most messages within the group! Lets take a look at the number of daily messages sent in the chatgroup since its inception.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-4-1.png" alt="Daily Number of Messages Sent in chatgroup (2019 to date)" width="624" />
<p class="caption">
Figure 1: Daily Number of Messages Sent in chatgroup (2019 to date)
</p>
</div>
</div>
<p>Interesting! The number of daily number of messages within the chatgroup increased after 2022. Perhaps as life returned to a post-covid normal, messaging within the group increased as we were out and about much more, and required more coordination amidst our activities. Or maybe we were just more active on our phones?</p>
<h3 id="tokenize-the-words">Tokenize the words</h3>
<p>In order to run sentiment analysis on the chat, each message needed to be parsed into individual words. This process of tokenizing the words is easily done within R using the function <em>unnest_tokens()</em>. This resulted in approximately 515,000 tokens.</p>
<p>Next, I removed stop-words using tidytext::stop_words and anti_join(). These stop-words carry no meaning in sentiment analysis and are therefore removed prior to analysis. You are also able to remove names or other words you deem irrelevant by adding them to a custom lexicon. You will read more about that later</p>
<h3 id="afinn-bing-and-nrc">AFINN, BING and NRC</h3>
<p>Heres a short introduction of the 3 sentiment lexicons I used to assist with sentiment analysis:</p>
<p>AFINN is a lexicon of English words rated for valence with an integer between minus five (negative) and plus five (positive). The words have been manually labeled by Finn rup Nielsen in 2009-2011. You can read more about AFINN <a href="https://search.r-project.org/CRAN/refmans/textdata/html/lexicon_afinn.html#:~:text=AFINN%20is%20a%20lexicon%20of,and%20plus%20five%20(positive).">here</a>.</p>
<p>Bing is a general purpose English sentiment lexicon that categorizes words in a binary fashion, either positive or negative. It was first published by Minqing Hu and Bing Liu in 2004. You can read more about Bing <a href="https://search.r-project.org/CRAN/refmans/textdata/html/lexicon_bing.html">here</a>.</p>
<p>The NRC Emotion Lexicon is a list of 5,636 English words and their associations with eight basic emotions (anger, fear, anticipation, trust, surprise, sadness, joy, and disgust) and two sentiments (negative and positive). You can read more about NRC <a href="https://search.r-project.org/CRAN/refmans/textdata/html/lexicon_nrc.html">here</a>.</p>
<p>I used these 3 dictionaries to perform sentiment analysis on the word tokens.</p>
<h3 id="lets-do-some-very-basic-eda">Lets do some very basic EDA</h3>
<p>Using the AFINN indexed list of words (data_for_NLP_AFINN_indexed), here is the top 20 most frequently used words in our chatgroup:</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-9">Table 1: </span>Top 20 Most Frequently Used Words in Chatgroup
</caption>
<thead>
<tr>
<th style="text-align:left;">
Word
</th>
<th style="text-align:center;">
Count
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
love
</td>
<td style="text-align:center;">
1241
</td>
</tr>
<tr>
<td style="text-align:left;">
leave
</td>
<td style="text-align:center;">
794
</td>
</tr>
<tr>
<td style="text-align:left;">
nice
</td>
<td style="text-align:center;">
478
</td>
</tr>
<tr>
<td style="text-align:left;">
wow
</td>
<td style="text-align:center;">
332
</td>
</tr>
<tr>
<td style="text-align:left;">
drop
</td>
<td style="text-align:center;">
272
</td>
</tr>
<tr>
<td style="text-align:left;">
bad
</td>
<td style="text-align:center;">
244
</td>
</tr>
<tr>
<td style="text-align:left;">
fun
</td>
<td style="text-align:center;">
225
</td>
</tr>
<tr>
<td style="text-align:left;">
haha
</td>
<td style="text-align:center;">
214
</td>
</tr>
<tr>
<td style="text-align:left;">
yeah
</td>
<td style="text-align:center;">
212
</td>
</tr>
<tr>
<td style="text-align:left;">
safe
</td>
<td style="text-align:center;">
201
</td>
</tr>
<tr>
<td style="text-align:left;">
join
</td>
<td style="text-align:center;">
186
</td>
</tr>
<tr>
<td style="text-align:left;">
free
</td>
<td style="text-align:center;">
184
</td>
</tr>
<tr>
<td style="text-align:left;">
hope
</td>
<td style="text-align:center;">
184
</td>
</tr>
<tr>
<td style="text-align:left;">
cut
</td>
<td style="text-align:center;">
179
</td>
</tr>
<tr>
<td style="text-align:left;">
happy
</td>
<td style="text-align:center;">
156
</td>
</tr>
<tr>
<td style="text-align:left;">
clean
</td>
<td style="text-align:center;">
155
</td>
</tr>
<tr>
<td style="text-align:left;">
shit
</td>
<td style="text-align:center;">
142
</td>
</tr>
<tr>
<td style="text-align:left;">
fine
</td>
<td style="text-align:center;">
140
</td>
</tr>
<tr>
<td style="text-align:left;">
luck
</td>
<td style="text-align:center;">
128
</td>
</tr>
<tr>
<td style="text-align:left;">
enjoy
</td>
<td style="text-align:center;">
125
</td>
</tr>
</tbody>
</table>
</div>
<p>Now heres a slight problem. The word leave, which has a frequency of 794 and carries a sentiment score of -1 in AFINN. As our family frequently uses the chatgroup to coordinate our schedules, the word leave is likely taken our of context here.</p>
<p>For example: Lets leave at 9am or We plan to leave at 7pm today. As opposed to  I have going to leave you! which has a negative context.</p>
<p>Remember I mentioned above about adding custom stopwords? To avoid potentially skewing the results, I decided removed the word leave by including it as a custom lexicon stop-word. Thereafter, I ran the analysis using AFINN again.</p>
<p>Similarly, the word swim is found within the NRC sentiments of anticipation, fear (really? why?) and joy. As both my sons are competitive swimmers and the word swim is used very frequently within our chat (760 times to be exact!), swim was removed as well.</p>
<p>Just for fun, and probably to show off what I learnt in class, here is a word cloud after removing the word leave.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-c378eefa74dfa1fda81b" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-c378eefa74dfa1fda81b">{"x":{"word":["love","nice","wow","drop","bad","fun","haha","yeah","safe","join","free","hope","cut","happy","clean","shit","fine","luck","enjoy","stop","sigh","lol","cute","top","funny","miss","sweet","sick","sad","pay","worry","care","warm","hard","share","wrong","damn","keen","super","agree","cool","lost","feeling","forget","dear","smart","tired","lucky","poor","stall"],"freq":[1241,478,332,272,244,225,214,212,201,186,184,184,179,156,155,142,140,128,125,117,109,108,100,98,96,96,93,88,87,86,86,84,83,82,82,82,80,78,77,75,75,73,72,70,64,64,62,61,60,60],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.145044319097502,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 2: WordCloud: Top 50 words after removing leave
</p>
</div>
</div>
<p>As you can see, its a rather nice chatgroup to be a part of, with positive words such as love, nice and happy. Of course, there are also negative words being used, of which shit stands out. Im cautiously optimistic that the overall AFINN index of our chat will be positive. </p>
<h3 id="have-fun-with-word-cloud">Have fun with word cloud</h3>
<p>Word cloud is rather fun and its easy to get carried away. So heres a couple more. This is a word cloud of our top 50 most frequently used words with a sentiment score &lt;0.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-65d9b540654bc11dff09" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-65d9b540654bc11dff09">{"x":{"word":["drop","bad","cut","shit","stop","sigh","miss","sick","sad","pay","worry","hard","wrong","damn","lost","forget","tired","poor","stall","crazy","dirty","negative","wtf","cancel","empty","alarm","dick","stupid","weird","sore","worried","worse","waste","ass","doubt","alert","missed","pain","upset","cancelled","scared","bored","cutting","stopped","broke","scam","avoid","fire","bother","chilling","dumb","kill","silly","stuck"],"freq":[272,244,179,142,117,109,96,88,87,86,86,82,82,80,73,70,62,60,60,55,51,51,46,44,44,42,40,39,39,38,36,34,31,30,30,29,29,29,29,27,26,25,25,24,23,23,22,22,21,21,21,21,21,21],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.6617647058823529,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3: Top 50 Frequently used words with negative sentiment score
</p>
</div>
</div>
<p>This is a word cloud of my top 50 most frequently used words. Hey, I use love quite a lot :)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-13"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-8fd75f11f3feef3d7cd8" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-8fd75f11f3feef3d7cd8">{"x":{"word":["love","nice","wow","yeah","safe","bad","haha","fun","drop","free","cut","miss","sigh","happy","clean","shit","hope","sick","join","lucky","stop","top","lost","save","warm","feeling","luck","pay","sad","fine","tired","chance","amazing","damn","keen","share","poor","super","wtf","smart","cancel","win","worry","cute","dick","positive","empty","enjoy","funny","hard","wrong"],"freq":[636,206,158,158,114,102,99,92,88,77,72,62,59,57,54,53,49,49,41,41,41,41,40,40,40,37,35,35,34,32,32,31,30,30,29,29,24,24,24,23,22,22,22,21,21,21,20,19,19,19,19],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.2830188679245283,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 4: WordCloud: Marks Top 50 most frequently used words
</p>
</div>
</div>
<p>Here is Marcs top 50 most frequently used words. Now we know who uses the word shit frequently. Still, it looks relatively positive.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-14"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-f7c8a2617bf19ad1b263" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-f7c8a2617bf19ad1b263">{"x":{"word":["nice","shit","lol","fine","love","cool","bad","cute","drop","free","funny","wow","luck","happy","join","cut","stop","haha","wrong","damn","crazy","yeah","fun","hahaha","stupid","wtf","negative","dumb","worse","hard","sad","top","feeling","ill","sore","positive","tired","clean","fit","hahahah","safe","stopped","ban","lost","scared","sick","agree","dick","super","alert","cancelled","hope","pay","straight","worry"],"freq":[85,60,56,47,41,40,37,35,31,31,31,31,30,26,26,25,25,22,22,21,20,20,19,19,18,18,17,16,16,14,14,14,13,13,13,12,12,11,11,11,11,11,10,10,10,10,9,9,9,8,8,8,8,8,8],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":2.117647058823529,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 5: WordCloud: Marcs Top 50 most frequently used words
</p>
</div>
</div>
<p>This is Andrews top 50 most frequently used words. It would appear that he uses the word love quite frequently. </p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-15"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-4ba5ce7570a8e2b16054" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-4ba5ce7570a8e2b16054">{"x":{"word":["love","lol","yeah","haha","nice","luck","care","fine","bad","happy","fun","funny","ha","join","shit","wow","stupid","safe","smart","agree","ass","damn","hard","hope","top","clean","fit","sick","stop","true","wrong","alarm","cut","cool","feeling","forget","free","sigh","warm","cute","enjoy","hahaha","nuts","pay","sad","save","super","weird","clever","cutting","dick","died","gun","lobby","matter","miss","pain","sweet"],"freq":[301,28,23,22,20,19,17,15,14,14,12,12,11,11,11,11,10,9,9,8,8,8,8,8,8,7,7,7,7,7,7,6,6,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.5980066445182725,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 6: WordCloud: Andrews Top 50 most frequently used words
</p>
</div>
</div>
<p>Last but not least, here is a word cloud of my wifes top 50 most frequently used words.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-16"></span>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-e2c20cae6e73eb24d667" style="width:624px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-e2c20cae6e73eb24d667">{"x":{"word":["love","nice","drop","wow","hope","join","enjoy","fun","bad","clean","cut","free","haha","sweet","safe","happy","worry","dreams","agree","forget","keen","woo","care","fine","share","stall","luck","stop","dear","hard","cute","super","pay","sigh","dirty","easy","poor","sad","top","funny","wrong","warm","weird","miss","smart","doubt","lol","sick","alarm","damn","fresh","lost"],"freq":[263,167,151,132,119,108,102,102,91,83,76,71,71,71,67,59,56,54,53,49,49,48,46,46,46,45,44,44,43,41,40,40,39,38,35,35,35,35,35,34,34,33,30,25,25,22,22,22,21,21,21,21],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.6844106463878327,"backgroundColor":"black","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 7: WordCloud: Angelinas Top 50 most frequently used words
</p>
</div>
</div>
<h3 id="sentiment-analysis-using-afinn-index">Sentiment Analysis using AFINN Index</h3>
<p>Lets shift gears and take a deeper look at what the AFINN indexed list of words reveal about the sentiment within our chatgroup.</p>
<p>The list of tokenized words were analyzed using the AFINN dictionary, where each word is given a sentiment score ranging from -5 (negative sentiment) to +5 (positive sentiment).</p>
<p>I calculated an average sentiment score and standard error for each member of the family.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-17">Table 2: </span>Average Sentiment of family members
</caption>
<thead>
<tr>
<th style="text-align:left;">
Name
</th>
<th style="text-align:center;">
Average Sentiment
</th>
<th style="text-align:center;">
Standard Error
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Andrew
</td>
<td style="text-align:center;">
1.378
</td>
<td style="text-align:center;">
0.074
</td>
</tr>
<tr>
<td style="text-align:left;">
Mark
</td>
<td style="text-align:center;">
0.659
</td>
<td style="text-align:center;">
0.032
</td>
</tr>
<tr>
<td style="text-align:left;">
Aaangelina
</td>
<td style="text-align:center;">
0.639
</td>
<td style="text-align:center;">
0.031
</td>
</tr>
<tr>
<td style="text-align:left;">
Marc
</td>
<td style="text-align:center;">
0.112
</td>
<td style="text-align:center;">
0.058
</td>
</tr>
<tr>
<td style="text-align:left;">
Family
</td>
<td style="text-align:center;">
0.627
</td>
<td style="text-align:center;">
0.020
</td>
</tr>
</tbody>
</table>
</div>
<p>My wife and I had an average sentiment score similar to that of the overall Family. Andrew had the highest average sentiment score (perhaps he uses the word love too often?) while Marc had the lowest average sentiment score.</p>
<p>Here is a boxplot summarizing the results,</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-18-1.png" alt="Sentiment Analysis of Yeo Family chatgroup (AFINN)" width="624" />
<p class="caption">
Figure 8: Sentiment Analysis of Yeo Family chatgroup (AFINN)
</p>
</div>
</div>
<p>The difference in average sentiment score between Marc and Andrew stands out. Andrews AFINN sentiment score is much higher than Marcs. Does this simply imply the use of more positive language within the chat, or does it make inference to a difference in their personalities? Can the difference be attributed to age where a younger child tends to be more openly expressive with his feelings, while an older child is more reserved?</p>
<p>Personally, I am surprised that the AFINN sentiment analysis of our chats was able to quite accutately make inference to the personality of my children. Marc tends to be more reserved and neutral, which may explain his use of words that are less emotionally charged and balanced. On the other hand, Andrew is more outgoing, bubbly and optimistic, which may explain his higher average sentiment score. Or maybe he simply loves the word love which carries a sentiment score of +3.</p>
<h3 id="cumulative-average-daily-sentiment">Cumulative Average Daily Sentiment</h3>
<p>Next, I plotted the cumulative average daily sentiment for each member of the family. Im not sure what I was hoping to find. If you had a neutral average daily sentiment score, the line should be flat. If you were generally positive, Id expect an upward sloping line. Conversely, periods of sustained negative sentiment would result in a downward trend.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-19"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-19-1.png" alt="Cumulative Average Daily Sentiment Score (AFINN)" width="624" />
<p class="caption">
Figure 9: Cumulative Average Daily Sentiment Score (AFINN)
</p>
</div>
</div>
<p>A couple of interesting observations:</p>
<ol type="1">
<li><p>Andrew had a significant increase in cumulative average daily sentiment score between 2022 and 2023. We discussed this, and brainstormed for possible reasons. I felt that possibly covid reopening and life back to normal was a contributing factor to his improved sentiment. Being more outgoing, perhaps covid-restrictions had a larger impact on his sentiment. Andrew thinks that his move to a different competitive swim club with a less toxic culture and people might have been a contributing factor in lifting his general mood.</p></li>
<li><p>The plot for Marc is almost flat throughout the year, reaching a peak score of only 75. This could imply days of positive average sentiment cancelling out days of negative sentiment, or simply the use of language that is emotionally neutral. Alarmingly, the plot showed a decline from mid-2022 to the start of 2023. We brainstormed for possible reasons to explain this, but none come to mind.</p></li>
</ol>
<p>Here is Marcs plot.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-20"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-20-1.png" alt="Marc's Cumulative Average Daily Sentiment Score (AFINN)" width="624" />
<p class="caption">
Figure 10: Marcs Cumulative Average Daily Sentiment Score (AFINN)
</p>
</div>
</div>
<h3 id="sentiment-analysis-marc-vs-andrew">Sentiment Analysis: Marc vs Andrew</h3>
<p>I am curious to explore the difference in sentiment scores between Marc and Andrew. To investigate further, I looked for words that they used in common, and analyzed to see if the frequency of usage of these words contributed to the difference in their sentiment scores.</p>
<p>To do this, I first created individual AFINN-indexed word lists for each child. Marc used 1783 AFINN-indexed words, while Andrew used 921 AFINN-indexed words. I then calculated their respective frequency of AFINN-indexed word usage.</p>
<p>Next, I created a list of AFINN-indexed words that they used in common using inner_join(). This resulted in a list of 138 AFINN-indexed words that they used in common.</p>
<p>I created a plot of these 138 words that they used in common, with the frequency of word usage by Andrew on the x-axis, and the frequency of word usage by Marc on the y-axis.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-22"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-22-1.png" alt="Frequency of Usage (Words in Common) Marc vs Andrew" width="624" />
<p class="caption">
Figure 11: Frequency of Usage (Words in Common) Marc vs Andrew
</p>
</div>
</div>
<p>Its quite apparent that the frequency of usage of the word love by Andrew is an outlier (32% vs 2% usage by Marc). In order to get a clearer picture of the other words in use, I removed the word love before generating the same plot again.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-23"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-23-1.png" alt="Frequency of Word Usage (Words in Common) Marc vs Andrew. The word `love` has been removed." width="624" />
<p class="caption">
Figure 12: Frequency of Word Usage (Words in Common) Marc vs Andrew. The word <code>love</code> has been removed.
</p>
</div>
</div>
<p>You may notice (or if you actually counted), not all 138 (or 137 minus the word love) words have been plotted. That is because check_overlap in geom_text() has been set to TRUE to avoid the text from overlapping.</p>
<p>Words that are close to or on the blue line (AB Line with slope = 1, intercept = 0) represent words that both children use with similar frequency. Examples of these words are super, died, stupid, happy, and lol. Marc uses the words nice and shit more frequently than Andrew, while Andrew uses the words haha, yeah, and care more frequently than Marc.</p>
<p>Is it apparent now why Andrew might have a higher AFINN sentiment score in his chats? Maybe the next plot will give a clearer indication. I multiplied the frequency of each word used by its AFINN sentiment value.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-24"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-24-1.png" alt="Frequency of word used x AFINN Sentiment Value" width="624" />
<p class="caption">
Figure 13: Frequency of word used x AFINN Sentiment Value
</p>
</div>
</div>
<p>Again, we see the use or excessive use of the word love most likely skewing Andrews sentiment score vs Marc, which is not a bad thing :). Lets look at the same plot with the word love removed.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-25"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-25-1.png" alt="Frequency of word used x AFINN Sentiment Value. The word 'love' has been removed." width="624" />
<p class="caption">
Figure 14: Frequency of word used x AFINN Sentiment Value. The word love has been removed.
</p>
</div>
</div>
<h3 id="tokenizing-by-n-grams">Tokenizing by n-grams</h3>
<p>Thus far, Ive only considered words as individual units, and evaluated their relationships to sentiments. However, tokenizing by single-words has its drawbacks because relationships exist between words that follow one-another.</p>
<p>This is because words correlate with one another, and the choice of first word can significantly change the meaning of the second word. For example, putting not before love significantly changes the meaning and therefore sentiment.</p>
<p>For the purpose of this project, I shall limit my analysis to pairs of words, or bigrams. You can certainly analyze further by using trigrams (n=3). Hence more generally, a token comprising n words is called an n-gram or ngram. Tokenizing on bigrams would allow me to capture and examine the immediate context around each word.</p>
<p>The output is word-pairs in the column bigram. The bigrams are then separated into columns word1 and word2, before filtering for numbers and stopwords. You can choose to recombine word1 and word2 back into bigrams, but I chose to leave them separated.</p>
<p>Heres a table of the top 20 paired words in terms of frequency of usage:</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-26">Table 3: </span>Top 20 Bigrams
</caption>
<thead>
<tr>
<th style="text-align:left;">
word1
</th>
<th style="text-align:center;">
word2
</th>
<th style="text-align:center;">
frequency
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
love
</td>
<td style="text-align:center;">
yall
</td>
<td style="text-align:center;">
160
</td>
</tr>
<tr>
<td style="text-align:left;">
sleep
</td>
<td style="text-align:center;">
tight
</td>
<td style="text-align:center;">
154
</td>
</tr>
<tr>
<td style="text-align:left;">
yall
</td>
<td style="text-align:center;">
tmr
</td>
<td style="text-align:center;">
144
</td>
</tr>
<tr>
<td style="text-align:left;">
bed
</td>
<td style="text-align:center;">
bugs
</td>
<td style="text-align:center;">
106
</td>
</tr>
<tr>
<td style="text-align:left;">
bugs
</td>
<td style="text-align:center;">
bite
</td>
<td style="text-align:center;">
106
</td>
</tr>
<tr>
<td style="text-align:left;">
coming
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
105
</td>
</tr>
<tr>
<td style="text-align:left;">
tight
</td>
<td style="text-align:center;">
dont
</td>
<td style="text-align:center;">
103
</td>
</tr>
<tr>
<td style="text-align:left;">
tmr
</td>
<td style="text-align:center;">
sleep
</td>
<td style="text-align:center;">
103
</td>
</tr>
<tr>
<td style="text-align:left;">
bye
</td>
<td style="text-align:center;">
bye
</td>
<td style="text-align:center;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
kor
</td>
<td style="text-align:center;">
kor
</td>
<td style="text-align:center;">
79
</td>
</tr>
<tr>
<td style="text-align:left;">
mom
</td>
<td style="text-align:center;">
love
</td>
<td style="text-align:center;">
76
</td>
</tr>
<tr>
<td style="text-align:left;">
water
</td>
<td style="text-align:center;">
polo
</td>
<td style="text-align:center;">
68
</td>
</tr>
<tr>
<td style="text-align:left;">
otw
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
66
</td>
</tr>
<tr>
<td style="text-align:left;">
bowling
</td>
<td style="text-align:center;">
alley
</td>
<td style="text-align:center;">
63
</td>
</tr>
<tr>
<td style="text-align:left;">
car
</td>
<td style="text-align:center;">
park
</td>
<td style="text-align:center;">
63
</td>
</tr>
<tr>
<td style="text-align:left;">
pls
</td>
<td style="text-align:center;">
dont
</td>
<td style="text-align:center;">
61
</td>
</tr>
<tr>
<td style="text-align:left;">
marcy
</td>
<td style="text-align:center;">
pls
</td>
<td style="text-align:center;">
58
</td>
</tr>
<tr>
<td style="text-align:left;">
dont
</td>
<td style="text-align:center;">
worry
</td>
<td style="text-align:center;">
57
</td>
</tr>
<tr>
<td style="text-align:left;">
sweet
</td>
<td style="text-align:center;">
dreams
</td>
<td style="text-align:center;">
55
</td>
</tr>
<tr>
<td style="text-align:left;">
yeah
</td>
<td style="text-align:center;">
yeah
</td>
<td style="text-align:center;">
54
</td>
</tr>
</tbody>
</table>
</div>
<p>Nope! We dont have bed bugs at home. Instead, the bigrams come from our favorite good-night phrase sleep tight, dont let the bed bugs bite.</p>
<p>Going beyond counting, we can actually visualize the connections and correlations between words in the chatgroup thanks to igraph.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-27"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-27-1.png" alt="igraph Plot of Top 50 bigrams" width="624" />
<p class="caption">
Figure 15: igraph Plot of Top 50 bigrams
</p>
</div>
</div>
<p>And heres the cool looking igraph, where arrows show the direction of correlation between words. The weights of the arrows shoe the number of times each bigram is used. The graph plots the top 50 bigrams used in our chat. Thats so cool!</p>
<p>As you can see, there arent any negating words such as not love or bigrams with negative-positive sentiment within the top 50 bigrams. As the bulk of this chat happened during the covid and post-covid period, youll see interesting bigrams like wear mask, stay safe and sore throat.</p>
<h3 id="sentiment-analysis-using-bing">Sentiment Analysis using Bing</h3>
<p>Recall that Bing is a general purpose English sentiment lexicon that categorizes words in a binary fashion, either positive or negative.</p>
<p>Here is the top 10 most frequently used words in our chatgroup, indexed using Bing. Within this list, there are 9 positive sentiment words and 1 negative sentiment word.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-28">Table 4: </span>Top 10 most frequently used words, indexed by Bing
</caption>
<thead>
<tr>
<th style="text-align:left;">
word1
</th>
<th style="text-align:center;">
word2
</th>
<th style="text-align:center;">
frequency
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
love
</td>
<td style="text-align:center;">
1241
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
nice
</td>
<td style="text-align:center;">
478
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
ready
</td>
<td style="text-align:center;">
370
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
wow
</td>
<td style="text-align:center;">
332
</td>
</tr>
<tr>
<td style="text-align:left;">
negative
</td>
<td style="text-align:center;">
bad
</td>
<td style="text-align:center;">
244
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
fun
</td>
<td style="text-align:center;">
225
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
safe
</td>
<td style="text-align:center;">
201
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
free
</td>
<td style="text-align:center;">
184
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
happy
</td>
<td style="text-align:center;">
156
</td>
</tr>
<tr>
<td style="text-align:left;">
positive
</td>
<td style="text-align:center;">
clean
</td>
<td style="text-align:center;">
155
</td>
</tr>
</tbody>
</table>
</div>
<p>Here is a plot comparing the top 10 negative and positive sentiment words used in our chat. Im happy to see that the use of positive sentiment words far overwhelm the use of negative sentiment words.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-29"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-29-1.png" alt="Top 10 Negative and Positive Sentiment Words, indexed by Bing" width="624" />
<p class="caption">
Figure 16: Top 10 Negative and Positive Sentiment Words, indexed by Bing
</p>
</div>
</div>
<p>Heres a different way of looking at the same data, this time the usage of negative sentiment words is represented on the negative x-axis. Which way of visualization do you prefer?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-30"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-30-1.png" alt="Top 10 Negative and Positive Sentiment Words, indexed by Bing, represented on negative-positive scale" width="624" />
<p class="caption">
Figure 17: Top 10 Negative and Positive Sentiment Words, indexed by Bing, represented on negative-positive scale
</p>
</div>
</div>
<h3 id="net-sentiment-using-bing">Net Sentiment Using Bing</h3>
<p>Although Bing classifies words in a binary manner, positive or negative, it is still possible to calculate a score that gives you an indication of the overall sentiment. Each occurrence of a positive word is given a sentiment score of +1, while a negative word is given a sentiment score of -1. This allows me to calculate a net sentiment score, and in this case, I did so for each member of the family.</p>
<p>What do you think this analysis will reveal? Are you surprised by the result?</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-31">Table 5: </span>Net Sentiment Score, indexed by Bing
</caption>
<thead>
<tr>
<th style="text-align:left;">
Family Member
</th>
<th style="text-align:center;">
Net Sentiment
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Aaangelina
</td>
<td style="text-align:center;">
635
</td>
</tr>
<tr>
<td style="text-align:left;">
Andrew
</td>
<td style="text-align:center;">
184
</td>
</tr>
<tr>
<td style="text-align:left;">
Marc
</td>
<td style="text-align:center;">
-168
</td>
</tr>
<tr>
<td style="text-align:left;">
Mark
</td>
<td style="text-align:center;">
734
</td>
</tr>
</tbody>
</table>
</div>
<p>Next, I investigated the top 10 most frequently used positive and negative words by each member of the family. The chart was easily created using facet_wrap().</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-32"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-32-1.png" alt="Top 10 Frequently used Positive and Negative words, indexed by Bing, for each family member" width="624" />
<p class="caption">
Figure 18: Top 10 Frequently used Positive and Negative words, indexed by Bing, for each family member
</p>
</div>
</div>
<p>Recall from earlier, I am the top user of the word love within the chat group. Well, Bing picked that up too. Now, why isnt my AFINN average sentiment index much higher? Hmmm, the only plausible explanation is that I must be using negative sentiment words quite frequently as well. </p>
<p>As for Marc, his number of negative sentiment words used (1038) outnumbers the number of positive sentiment words used (870). But his top 10 negative and positive words used is quite balanced.</p>
<h3 id="sentiment-analysis-using-nrc">Sentiment Analysis using NRC</h3>
<p>The NRC Emotion Lexicon is a list of 5,636 English words and their associations with eight basic emotions (anger, fear, anticipation, trust, surprise, sadness, joy, and disgust) and two sentiments (negative and positive). A word can be listed under multiple emotions. For example, the word bad is listed under the emotions anger, disgust, fear, and sadness, as well as the negative sentiment.</p>
<p>A total of 35,688 words from the chatgroup were indexed by NRC, and here is a summary by the eight basic emotions:</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-33">Table 6: </span>Proportion of words in each NRC sentiment
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sentiment
</th>
<th style="text-align:center;">
Number of Words
</th>
<th style="text-align:center;">
Frequency
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anticipation
</td>
<td style="text-align:center;">
9556
</td>
<td style="text-align:center;">
26.78
</td>
</tr>
<tr>
<td style="text-align:left;">
trust
</td>
<td style="text-align:center;">
6775
</td>
<td style="text-align:center;">
18.98
</td>
</tr>
<tr>
<td style="text-align:left;">
joy
</td>
<td style="text-align:center;">
5563
</td>
<td style="text-align:center;">
15.59
</td>
</tr>
<tr>
<td style="text-align:left;">
fear
</td>
<td style="text-align:center;">
3549
</td>
<td style="text-align:center;">
9.94
</td>
</tr>
<tr>
<td style="text-align:left;">
sadness
</td>
<td style="text-align:center;">
3127
</td>
<td style="text-align:center;">
8.76
</td>
</tr>
<tr>
<td style="text-align:left;">
anger
</td>
<td style="text-align:center;">
2459
</td>
<td style="text-align:center;">
6.89
</td>
</tr>
<tr>
<td style="text-align:left;">
surprise
</td>
<td style="text-align:center;">
2404
</td>
<td style="text-align:center;">
6.74
</td>
</tr>
<tr>
<td style="text-align:left;">
disgust
</td>
<td style="text-align:center;">
2255
</td>
<td style="text-align:center;">
6.32
</td>
</tr>
</tbody>
</table>
</div>
<p>I always prefer to look at things visually, so heres a plot of the Top 10 words for each of the eight emotions.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-34-1.png" alt="Top 10 Words Categorized by NRC into Eight Basic Emotions" width="624" />
<p class="caption">
Figure 19: Top 10 Words Categorized by NRC into Eight Basic Emotions
</p>
</div>
</div>
<p>Its comes as no surprise to me that about 27 percent of words were categorized under the anticipation emotion. After all, we do use the chat quite frequently to coordinate our schedules and transportation needs. Its interesting that NRC was able to pick this up.</p>
<p>However, I noticed that NRC does have its quirks. Take a look at the top word in the fear emotion. Mum?? I know my wife is a scary person, but how did NRC know that? Mum to refer to my wife or my mother (or their mother, if you were my children). Perhaps in this case, NRC mistook it as to keep quiet? Perhaps we should spell it as mom from now on in our chats?</p>
<p>Do you notice any other strange classifications? battery &lt;-&gt; Anger, mother &lt;-&gt; Sadness are a few more that may have been incorrectly classified.</p>
<p>The next plot shows the relative frequency of each family members word usage by the eight basic NRC sentiments.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-35"></span>
<img src="whatsapp_files/figure-html5/unnamed-chunk-35-1.png" alt="Relative Frequency of Family Members' Word Usage by Sentiment, indexed by NRC" width="624" />
<p class="caption">
Figure 20: Relative Frequency of Family Members Word Usage by Sentiment, indexed by NRC
</p>
</div>
</div>
<p>What do you make of the results? Well, as parents, I suppose its normal that Angelina and I have the highest frequency of words in the anticipation category. Its also heartening to see that categories associated with negative sentiment (fear, anger, sadness and disgust) do not rank highly among our family members.</p>
<h3 id="final-thoughts">Final Thoughts</h3>
<p>I had fun working on this project. Not only did my skills in R impRove, it also revealed some interesting insights about my family members.</p>
<p>Was the analysis ground-breaking? Definitely not, and admittedly, there was a lot more I could have done, eg: tf-idf, analysis by tri-grams, by topic, or even at the sentence level. Maybe Ill do a more comprehensive analysis after I complete the next module on Machine Learning next year. Thanks for reading!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p> 2023  Made with the <a
href="https://github.com/rstudio/distill">distill</a> <a
href="https://cran.r-project.org"><svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:14px;width:15.89px;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#ededeb;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg></a>
package.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
